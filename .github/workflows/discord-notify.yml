# Modpack æ›´æ–°æ™‚ã« Discord ã¸é€šçŸ¥
name: Discord Notification

on:
  push:
    branches: [main]
    paths:
      - 'mods/**'
      - 'pack.toml'
      - 'index.toml'

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 2
          
      - name: Get changed mods
        id: changes
        run: |
          CHANGED=$(git diff --name-only HEAD~1 HEAD -- mods/ | sed 's/mods\///' | sed 's/\.pw\.toml//' | tr '\n' ', ' | sed 's/,$//')
          echo "mods=$CHANGED" >> $GITHUB_OUTPUT
          
      - name: Send Discord Notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          curl -H "Content-Type: application/json" \
            -d '{
              "embeds": [{
                "title": "ğŸ® Modpack ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸï¼",
                "description": "æ¬¡å›ã‚²ãƒ¼ãƒ èµ·å‹•æ™‚ã«è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™ã€‚",
                "color": 5763719,
                "fields": [
                  {
                    "name": "ğŸ“¦ å¤‰æ›´ã•ã‚ŒãŸ Mod",
                    "value": "'"${{ steps.changes.outputs.mods }}"'"
                  },
                  {
                    "name": "ğŸ“ ã‚³ãƒŸãƒƒãƒˆ",
                    "value": "[`'"${GITHUB_SHA:0:7}"'`]('"$GITHUB_SERVER_URL/$GITHUB_REPOSITORY/commit/$GITHUB_SHA"')"
                  }
                ],
                "footer": {
                  "text": "Minecraft 1.20.1 Modpack"
                },
                "timestamp": "'"$(date -u +%Y-%m-%dT%H:%M:%SZ)"'"
              }]
            }' \
            "$DISCORD_WEBHOOK"
