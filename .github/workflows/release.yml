# pushæ™‚ã« Prism Launcher ç”¨ã®èµ·å‹•æ§‹æˆzipã‚’è‡ªå‹•ç”Ÿæˆ
name: Build and Release

on:
  push:
    branches: [main]
    paths:
      - 'mods/**'
      - 'pack.toml'
      - 'index.toml'

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Download packwiz-installer-bootstrap
        run: |
          curl -sL -o packwiz-installer-bootstrap.jar \
            https://github.com/packwiz/packwiz-installer-bootstrap/releases/latest/download/packwiz-installer-bootstrap.jar
      
      - name: Create Prism Launcher instance
        run: |
          mkdir -p instance/.minecraft
          mkdir -p instance
          
          # packwiz-installer-bootstrap.jar ã‚’é…ç½®
          cp packwiz-installer-bootstrap.jar instance/.minecraft/
          
          # Prism Launcher ã® instance.cfg ã‚’ä½œæˆ
          cat > instance/instance.cfg << 'EOF'
          InstanceType=OneSix
          JavaVersion=17
          LogPrePostOutput=true
          ManagedPack=false
          ManagedPackID=
          ManagedPackName=
          ManagedPackType=
          ManagedPackVersionID=
          ManagedPackVersionName=
          OverrideCommands=true
          PreLaunchCommand="$INST_JAVA" -jar packwiz-installer-bootstrap.jar https://raw.githubusercontent.com/tekitounix/minecraft-modpack/main/pack.toml
          name=Modpack Server
          EOF
          
          # mmc-pack.json ã‚’ä½œæˆï¼ˆForge 47.4.0 æŒ‡å®šï¼‰
          cat > instance/mmc-pack.json << 'EOF'
          {
            "components": [
              {
                "uid": "net.minecraft",
                "version": "1.20.1"
              },
              {
                "uid": "net.minecraftforge",
                "version": "47.4.0"
              }
            ],
            "formatVersion": 1
          }
          EOF
      
      - name: Create zip
        run: |
          cd instance
          zip -r ../modpack-prism.zip .
          cd ..
      
      - name: Get current date
        id: date
        run: echo "date=$(date +'%Y%m%d-%H%M')" >> $GITHUB_OUTPUT
      
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v${{ steps.date.outputs.date }}
          name: Modpack ${{ steps.date.outputs.date }}
          body: |
            ## ğŸ® Modpack æ›´æ–°
            
            ### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•
            1. [Prism Launcher](https://prismlauncher.org/download/) ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
            2. `modpack-prism.zip` ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            3. Prism Launcher ã§ã€Œèµ·å‹•æ§‹æˆã‚’è¿½åŠ ã€â†’ã€Œzipã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã€
            4. èµ·å‹•ï¼
            
            åˆå›èµ·å‹•æ™‚ã«å…¨ã¦ã® Mod ãŒè‡ªå‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚
          files: modpack-prism.zip
          draft: false
          prerelease: false
