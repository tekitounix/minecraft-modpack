# Mod 追加/更新時に自動で index.toml を再生成
name: Update Packwiz Index

on:
  push:
    branches: [main]
    paths:
      - 'mods/**'
      - 'pack.toml'

jobs:
  update-index:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21'
          cache: false
      
      - name: Install Packwiz
        run: |
          go install github.com/packwiz/packwiz@latest
          packwiz --version
          
      - name: Refresh Index
        run: packwiz refresh
        
      - name: Commit changes
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add -A
          git diff --staged --quiet || git commit -m "Auto-update index.toml"
          git push
